---
title: '【浅显易懂系列】BA光束法平差法'
date: 2024-08-25
permalink: /posts/2024/08/ba/
tags:
  - 3D reconstruction
  - BA
---

Boudle Adjustment,BA 是一种在摄影测量和计算机视觉中广泛使用的技术，主要用于从多视角图像中优化相机的位姿（位置和姿态）以及三维点的坐标。以下是对BA光束法平差的详细介绍，结合数学公式和通俗事例进行阐述。

### 一、数学公式解释

#### 1. 基本概念

在BA中，我们有一系列的三维点$P_i = [X_i, Y_i, Z_i]^T$和相机位姿（通常表示为旋转矩阵$R$和平移向量$t$）。每个相机位姿和三维点都会通过投影矩阵$P$映射到图像平面上，形成观测到的二维点$u_{ij} = [u_{ij}, v_{ij}]^T$。

#### 2. 投影方程

投影方程通常表示为：


$\lambda_{ij} \begin{bmatrix} u_{ij} \\ v_{ij} \\ 1 \end{bmatrix} = P(R_j, t_j) \begin{bmatrix} X_i \\ Y_i \\ Z_i \\ 1 \end{bmatrix}$

其中，$\lambda_{ij}$是尺度因子，$P(R_j, t_j)$是相机$j$的投影矩阵，由旋转矩阵$R_j$和平移向量$t_j$决定。

#### 3. 重投影误差

由于观测噪声和相机位姿的不确定性，实际观测到的二维点$u_{ij}$与通过投影方程计算得到的点之间会存在误差。这个误差被称为重投影误差，可以表示为：

$e_{ij} = \begin{bmatrix} u_{ij} - \hat{u}_{ij} \\ v_{ij} - \hat{v}_{ij} \end{bmatrix}$

其中，$\hat{u}_{ij}$和$\hat{v}_{ij}$是通过投影方程计算得到的预测值。

#### 4. 优化目标

BA的目标是找到最优的相机位姿和三维点坐标，使得所有重投影误差的平方和最小，即：

$\min_{R_j, t_j, X_i, Y_i, Z_i} \sum_{i,j} \|e_{ij}\|^2$

这是一个非线性最小二乘问题，通常通过迭代优化算法（如高斯-牛顿法、列文伯格-马夸尔特法等）求解。

### 二、通俗事例结合数学公式

假设你站在一个房间里，手里拿着相机拍摄房间内的物体。由于你移动了位置并改变了相机的角度，你拍摄了多张照片。现在，你想通过这些照片来重建房间内物体的三维结构。

#### 1. 初始情况

你首先通过特征匹配等方法找到不同照片中相同物体的对应点。然而，由于相机的位姿未知和观测噪声的存在，这些对应点并不完全准确。

#### 2. BA过程

接下来，你使用BA来优化相机的位姿和三维点的坐标。你假设一个初始的相机位姿和三维点坐标，然后通过投影方程将这些三维点投影到图像平面上，得到预测的二维点。然后，你计算这些预测点与实际观测点之间的重投影误差。

#### 3. 迭代优化

你使用优化算法（如高斯-牛顿法）来迭代调整相机的位姿和三维点的坐标，以减小重投影误差。在每次迭代中，你都会根据当前的误差计算梯度，并沿着梯度的反方向更新相机的位姿和三维点的坐标。这个过程会重复进行，直到重投影误差达到一个可接受的水平或达到预设的迭代次数。

#### 4. 结果

最终，你会得到一组优化的相机位姿和三维点坐标，这些坐标能够更准确地描述房间内物体的三维结构。你可以使用这些坐标来生成三维模型、进行虚拟漫游等操作。

### 总结

BA光束法平差是一种通过优化相机位姿和三维点坐标来减小重投影误差的技术。它广泛应用于摄影测量和计算机视觉领域，是构建高精度三维模型的重要工具。通过数学公式和通俗事例的结合，我们可以更深入地理解BA的基本原理和优化过程。